# Reconnaissance & Enumeration

Remember to look at Machine Info Card：OS,Difficulty,Points,Release Date,IP,Machine Maker(s).

------



## Port Scan

reference: [Active Scanning](https://attack.mitre.org/techniques/T1595)，[Gather Victim Network Information](https://attack.mitre.org/techniques/T1590).

- ```shell
  # Official Writeup way
  ports=$(nmap -p- --min-rate=1000 -T4 10.10.x.x | grep ^[0-9] | cut -d'/' -f1 | tr '\n' ',' | sed s/,$//)
  nmap -sC -sV -p$ports 10.10.x.x
  ```
  
- ```shell
  # Another way
  masscan -e tun0 -p1-65535,U:1-65535 10.10.x.x --rate=1000 -oL /tmp/masscan.list
  tcpPorts=$(cat /tmp/masscan.list | grep "open tcp" | cut -d' ' -f3 | tr '\n' ',' | sed s/,$//)
  nmap -sC -sV -A -p$tcpPorts 10.10.x.x
  ```

- ```shell
  # UDP
  udpPorts=$(cat /tmp/masscan.list | grep "open udp" | cut -d' ' -f3 | tr '\n' ',' | sed s/,$//)
  nmap -sC -sV -A -sU -p$udpPorts 10.10.x.x
  ```

- ```shell
  rustscan -a 10.10.x.x --ulimit 10000
  ```

- ```shell
  # for details, open -vv option.
  nmap -sC -sV -vv -p 21 10.10.x.x
  PORT   STATE SERVICE REASON         VERSION
  21/tcp open  ftp     syn-ack ttl 63 vsftpd 2.0.8 or later
  | ssl-cert: Subject: commonName=*.test.htb/organizationName=Test Ltd./stateOrProvinceName=NY/countryName=US/emailAddress=info@sub.test.htb
  | Issuer: commonName=*.test.htb/organizationName=Cross Fit Ltd./stateOrProvinceName=NY/countryName=US/emailAddress=info@sub.test.htb

  ```



## Directory Scan

Enumerate subdomains, web directories, paths, backups and extensions,normally for port 80,443,8***.

```shell
# web directories (with extensions)
gobuster dir -u http://test.htb -w /usr/share/dirb/wordlists/common.txt -t 30 -s 200,204,301,302,307,401,403 -x html,htm,php,txt,zip,xml
gobuster dir -u http://10.10.10.191 -w /usr/share/wordlists/dirb/common.txt -x txt,pdf,php
gobuster dir -u http://test.htb/sub -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50

rustbuster dir --url http://10.10.10.187/utility-scripts/ --wordlist /usr/share/SecLists/Discovery/Web-Content/big.txt --extensions php,txt --threads 15

ffuf -u https://test.ht/FUZZ -w /usr/share/wordlists/dirb/common.txt
wfuzz -u http://test.htb/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-large-words-lowercase.txt -t 10

# subdomain
wfuzz -c -z list,"1-2-3-4-5" -H "HOST: FUZZ.test.htb" http://10.10.x.x
wfuzz -c --hw 933 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -H "HOST: FUZZ.test.htb" http://10.10.x.x

# backup
bfac --url http://test.htb

# other dicts
/usr/share/seclists/Discovery/Web-Content/raft-large-words-lowercase.txt
/usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
/usr/share/seclists/Discovery/DNS/dns-Jhaddix.txt
```



## Common Services

  ```shell
# port 21,
# try anonymous-login first according Nmap output,or use firefox[ftp://10.10.x.x]
ftp 10.10.x.x
# if ftp server is configured to use SSL/TLS
openssl s_client -connect 10.10.10.x:21 -starttls ftp

# port 53
# try dns-zone-transfer first
dig AXFR test.htb @10.10.x.x -p53
# IP reverse resolution (PTR record)
dig -x 10.10.10.x @10.10.10.x -p53

# port 88
# try krb5-enum-users first
nmap -p 88 --script=krb5-enum-users --script-args krb5-enum-users.realm='MEGACORP.LOCAL',userdb=/usr/share/seclists/Usernames/Names/names.txt 10.10.x.x
# msf: auxiliary/gather/kerberos_enumusers

# port 135，enumerate network-interface first
IOXIDResolver.py -t 10.10.x.x

# port 389,3268,3269
ldapsearch -h 10.10.10.x -p 389 -x -b dc=hackthebox,dc=htb
ldapsearch -x -H ldap://10.10.x.x:3268 -D 'CN=Tom,CN=Users,dc=hackthebox,dc=htb' -w 'Tom pass' -b "DC=intelligence,DC=htb"

# port 445
# use smbclient,smbmap,cme,mount -t cifs...
smbclient -L //10.10.x.x/ -U "" -N
smbclient -L //10.10.x.x/ -U andy
smbclient //10.10.10.144/malware_dropbox -N
smbclient //10.10.x.x/C$ -U "Administrator" --pw-nt-hash f6b...67
smbmap -u anonymous -p anonymous -H 10.10.10.233 -R Software_Updates
crackmapexec smb 10.10.10.192 -u audit2020 -p 'H@CKTHEB0X#' --shares

# port 2049,nfs
showmount -e 10.10.x.x
mount -t nfs 10.10.x.x:/site_backups /mnt/backups -o nolock

# port 3128,Squid http proxy
squidclient -p3128 -h 10.x.x.x
  ```
